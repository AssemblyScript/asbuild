"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.InitCmd = void 0;
var files_1 = require("./files");
var utils_1 = require("../../utils");
var interfaces_1 = require("./interfaces");
var path = __importStar(require("path"));
var chalk_1 = __importDefault(require("chalk"));
var packageJson_1 = require("./files/packageJson");
var doneMsg = chalk_1.default(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\nDon't forget to install dependencies before you start:\n\n  ", "\n\nTo edit the entry file, open {cyan 'assembly/index.ts'} in your editor of choice.\nCreate as many additional files as necessary and use them as imports.\n\nTo build the entry file to WebAssembly when you are ready, run:\n\n  ", " build\n\nRunning the command above creates the following binaries incl. their respective\ntext format representations and source maps:\n\n  {cyan ./build/untouched.wasm}\n  {cyan ./build/untouched.wasm.map}\n  {cyan ./build/untouched.wat}\n\n  ^ The untouched WebAssembly module as generated by the compiler.\n    This one matches your sources exactly, without any optimizations.\n\n  {cyan ./build/optimized.wasm}\n  {cyan ./build/optimized.wasm.map}\n  {cyan ./build/optimized.wat}\n\n  ^ The optimized WebAssembly module using default optimization settings.\n    You can change the optimization settings in {cyan 'package.json'}.\n\nTo run the tests, do:\n\n  ", "\n\nThe AssemblyScript documentation covers all the details:\n\n  https://docs.assemblyscript.org\n\nHave a nice day!\n"], ["\nDon't forget to install dependencies before you start:\n\n  ", "\n\nTo edit the entry file, open {cyan 'assembly/index.ts'} in your editor of choice.\nCreate as many additional files as necessary and use them as imports.\n\nTo build the entry file to WebAssembly when you are ready, run:\n\n  ", " build\n\nRunning the command above creates the following binaries incl. their respective\ntext format representations and source maps:\n\n  {cyan ./build/untouched.wasm}\n  {cyan ./build/untouched.wasm.map}\n  {cyan ./build/untouched.wat}\n\n  ^ The untouched WebAssembly module as generated by the compiler.\n    This one matches your sources exactly, without any optimizations.\n\n  {cyan ./build/optimized.wasm}\n  {cyan ./build/optimized.wasm.map}\n  {cyan ./build/optimized.wat}\n\n  ^ The optimized WebAssembly module using default optimization settings.\n    You can change the optimization settings in {cyan 'package.json'}.\n\nTo run the tests, do:\n\n  ", "\n\nThe AssemblyScript documentation covers all the details:\n\n  https://docs.assemblyscript.org\n\nHave a nice day!\n"])), packageJson_1.getPmCommands().install, packageJson_1.getPmCommands().run, packageJson_1.getPmCommands().test);
function initMsg(baseDir) {
    var msg = [
        chalk_1.default(templateObject_2 || (templateObject_2 = __makeTemplateObject(["This command will make sure that the following files exist in the project"], ["This command will make sure that the following files exist in the project"]))),
        chalk_1.default(templateObject_3 || (templateObject_3 = __makeTemplateObject(["directory {bold \"", "\":}"], ["directory {bold \"", "\":}"])), baseDir),
        "",
    ];
    for (var _i = 0, initFiles_1 = files_1.initFiles; _i < initFiles_1.length; _i++) {
        var file = initFiles_1[_i];
        msg.push(chalk_1.default(templateObject_4 || (templateObject_4 = __makeTemplateObject(["  {cyan ./", "}"], ["  {cyan ./", "}"])), file.path));
        msg.push(chalk_1.default(templateObject_5 || (templateObject_5 = __makeTemplateObject(["  ", ""], ["  ", ""])), file.description));
        msg.push("");
    }
    msg.push("The command will try to update existing files to match the correct settings");
    msg.push("");
    return msg.join("\n");
}
exports.InitCmd = {
    command: "init [baseDir]",
    describe: "Create a new AS package in an given directory",
    builder: function (y) {
        return y.positional("baseDir", {
            type: "string",
            default: ".",
            description: "Create a sample AS project in this directory",
        });
    },
    handler: function (args) { return __awaiter(void 0, void 0, void 0, function () {
        var baseDir;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    baseDir = path.resolve(args.baseDir);
                    console.log(initMsg(baseDir));
                    return [4 /*yield*/, utils_1.askYesNo(chalk_1.default(templateObject_6 || (templateObject_6 = __makeTemplateObject(["{bold Hello?}"], ["{bold Hello?}"]))))];
                case 1:
                    if (!(_a.sent()))
                        return [2 /*return*/];
                    try {
                        writeFiles(baseDir);
                        console.log(doneMsg);
                    }
                    catch (err) {
                        // https://github.com/yargs/yargs/issues/1069#issuecomment-468451450
                        // If error is thrown in async handler, parser is run twice which
                        // cause the help commands to print along with error stack
                        // So to prevent that we catch the error and simply print it.
                        console.error(chalk_1.default(templateObject_7 || (templateObject_7 = __makeTemplateObject(["{bold.bgRedBright ERROR:} Unexpected Error while trying to write init files."], ["{bold.bgRedBright ERROR:} Unexpected Error while trying to write init files."]))));
                        console.error(err);
                    }
                    return [2 /*return*/];
            }
        });
    }); },
};
function writeFiles(baseDir) {
    console.log();
    for (var _i = 0, initFiles_2 = files_1.initFiles; _i < initFiles_2.length; _i++) {
        var file = initFiles_2[_i];
        console.log(chalk_1.default(templateObject_8 || (templateObject_8 = __makeTemplateObject(["- Making sure that '", "' is set up..."], ["- Making sure that '", "' is set up..."])), file.path));
        var relativePath = file.getRelativePath(baseDir);
        switch (file.write(baseDir)) {
            case interfaces_1.InitResult.CREATED:
                console.log(chalk_1.default(templateObject_9 || (templateObject_9 = __makeTemplateObject(["  {green Created:} ", "\n"], ["  {green Created:} ", "\\n"])), relativePath));
                break;
            case interfaces_1.InitResult.EXISTS:
                console.log(chalk_1.default(templateObject_10 || (templateObject_10 = __makeTemplateObject(["  {yellow Exists:} ", "\n"], ["  {yellow Exists:} ", "\\n"])), relativePath));
                break;
            case interfaces_1.InitResult.UPDATED:
                console.log(chalk_1.default(templateObject_11 || (templateObject_11 = __makeTemplateObject(["  {greenBright Updated:} ", "\n"], ["  {greenBright Updated:} ", "\\n"])), relativePath));
                break;
            default:
                break;
        }
    }
    console.log(chalk_1.default(templateObject_12 || (templateObject_12 = __makeTemplateObject(["{bold.green Done!}"], ["{bold.green Done!}"]))));
}
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9, templateObject_10, templateObject_11, templateObject_12;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY21kLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbW1hbmRzL2luaXQvY21kLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsaUNBQW9DO0FBQ3BDLHFDQUF1QztBQUN2QywyQ0FBMEM7QUFDMUMseUNBQTZCO0FBQzdCLGdEQUEwQjtBQUMxQixtREFBb0Q7QUFFcEQsSUFBTSxPQUFPLEdBQUcsZUFBSyxtb0NBQUEsZ0VBR2pCLEVBQXVCLHVPQU92QixFQUFtQiwwcEJBcUJuQixFQUFvQix5SEFPdkIsS0FuQ0csMkJBQWEsRUFBRSxDQUFDLE9BQU8sRUFPdkIsMkJBQWEsRUFBRSxDQUFDLEdBQUcsRUFxQm5CLDJCQUFhLEVBQUUsQ0FBQyxJQUFJLENBT3ZCLENBQUM7QUFFRixTQUFTLE9BQU8sQ0FBQyxPQUFlO0lBQzlCLElBQUksR0FBRyxHQUFHO1FBQ1IsZUFBSyw4SUFBQSwyRUFBMkU7UUFDaEYsZUFBSywrRkFBQSxvQkFBb0IsRUFBTyxNQUFLLEtBQVosT0FBTztRQUNoQyxFQUFFO0tBQ0gsQ0FBQztJQUNGLEtBQWlCLFVBQVMsRUFBVCxjQUFBLGlCQUFTLEVBQVQsdUJBQVMsRUFBVCxJQUFTLEVBQUU7UUFBdkIsSUFBSSxJQUFJLGtCQUFBO1FBQ1gsR0FBRyxDQUFDLElBQUksQ0FBQyxlQUFLLG9GQUFBLFlBQWEsRUFBUyxHQUFHLEtBQVosSUFBSSxDQUFDLElBQUksRUFBSSxDQUFDO1FBQ3pDLEdBQUcsQ0FBQyxJQUFJLENBQUMsZUFBSywyRUFBQSxJQUFLLEVBQWdCLEVBQUUsS0FBbEIsSUFBSSxDQUFDLFdBQVcsRUFBRyxDQUFDO1FBQ3ZDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDZDtJQUNELEdBQUcsQ0FBQyxJQUFJLENBQ04sNkVBQTZFLENBQzlFLENBQUM7SUFDRixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2IsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3hCLENBQUM7QUFFWSxRQUFBLE9BQU8sR0FBd0I7SUFDMUMsT0FBTyxFQUFFLGdCQUFnQjtJQUN6QixRQUFRLEVBQUUsK0NBQStDO0lBQ3pELE9BQU8sRUFBRSxVQUFDLENBQUM7UUFDVCxPQUFBLENBQUMsQ0FBQyxVQUFVLENBQUMsU0FBUyxFQUFFO1lBQ3RCLElBQUksRUFBRSxRQUFRO1lBQ2QsT0FBTyxFQUFFLEdBQUc7WUFDWixXQUFXLEVBQUUsOENBQThDO1NBQzVELENBQUM7SUFKRixDQUlFO0lBQ0osT0FBTyxFQUFFLFVBQU8sSUFBSTs7Ozs7b0JBQ1osT0FBTyxHQUFXLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQWlCLENBQUMsQ0FBQztvQkFDN0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztvQkFDeEIscUJBQU0sZ0JBQVEsQ0FBQyxlQUFLLGtGQUFBLGVBQWUsS0FBQyxFQUFBOztvQkFBMUMsSUFBSSxDQUFDLENBQUMsU0FBb0MsQ0FBQzt3QkFBRSxzQkFBTztvQkFDcEQsSUFBSTt3QkFDRixVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7d0JBQ3BCLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7cUJBQ3RCO29CQUFDLE9BQU8sR0FBRyxFQUFFO3dCQUNaLG9FQUFvRTt3QkFDcEUsaUVBQWlFO3dCQUNqRSwwREFBMEQ7d0JBQzFELDZEQUE2RDt3QkFDN0QsT0FBTyxDQUFDLEtBQUssQ0FDWCxlQUFLLGlKQUFBLDhFQUE4RSxLQUNwRixDQUFDO3dCQUNGLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7cUJBQ3BCOzs7O1NBQ0Y7Q0FDRixDQUFDO0FBRUYsU0FBUyxVQUFVLENBQUMsT0FBZTtJQUNqQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDZCxLQUFpQixVQUFTLEVBQVQsY0FBQSxpQkFBUyxFQUFULHVCQUFTLEVBQVQsSUFBUyxFQUFFO1FBQXZCLElBQUksSUFBSSxrQkFBQTtRQUNYLE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBSywyR0FBQSxzQkFBdUIsRUFBUyxnQkFBZ0IsS0FBekIsSUFBSSxDQUFDLElBQUksRUFBaUIsQ0FBQztRQUNuRSxJQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ25ELFFBQVEsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUMzQixLQUFLLHVCQUFVLENBQUMsT0FBTztnQkFDckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFLLDhGQUFBLHFCQUFzQixFQUFZLEtBQUksS0FBaEIsWUFBWSxFQUFLLENBQUM7Z0JBQ3pELE1BQU07WUFDUixLQUFLLHVCQUFVLENBQUMsTUFBTTtnQkFDcEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFLLGdHQUFBLHFCQUFzQixFQUFZLEtBQUksS0FBaEIsWUFBWSxFQUFLLENBQUM7Z0JBQ3pELE1BQU07WUFDUixLQUFLLHVCQUFVLENBQUMsT0FBTztnQkFDckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFLLHNHQUFBLDJCQUE0QixFQUFZLEtBQUksS0FBaEIsWUFBWSxFQUFLLENBQUM7Z0JBQy9ELE1BQU07WUFDUjtnQkFDRSxNQUFNO1NBQ1Q7S0FDRjtJQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBSyx5RkFBQSxvQkFBb0IsS0FBQyxDQUFDO0FBQ3pDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyB5YXJncyBmcm9tIFwieWFyZ3NcIjtcbmltcG9ydCB7IGluaXRGaWxlcyB9IGZyb20gXCIuL2ZpbGVzXCI7XG5pbXBvcnQgeyBhc2tZZXNObyB9IGZyb20gXCIuLi8uLi91dGlsc1wiO1xuaW1wb3J0IHsgSW5pdFJlc3VsdCB9IGZyb20gXCIuL2ludGVyZmFjZXNcIjtcbmltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCBjaGFsayBmcm9tIFwiY2hhbGtcIjtcbmltcG9ydCB7IGdldFBtQ29tbWFuZHMgfSBmcm9tIFwiLi9maWxlcy9wYWNrYWdlSnNvblwiO1xuXG5jb25zdCBkb25lTXNnID0gY2hhbGtgXG5Eb24ndCBmb3JnZXQgdG8gaW5zdGFsbCBkZXBlbmRlbmNpZXMgYmVmb3JlIHlvdSBzdGFydDpcblxuICAke2dldFBtQ29tbWFuZHMoKS5pbnN0YWxsfVxuXG5UbyBlZGl0IHRoZSBlbnRyeSBmaWxlLCBvcGVuIHtjeWFuICdhc3NlbWJseS9pbmRleC50cyd9IGluIHlvdXIgZWRpdG9yIG9mIGNob2ljZS5cbkNyZWF0ZSBhcyBtYW55IGFkZGl0aW9uYWwgZmlsZXMgYXMgbmVjZXNzYXJ5IGFuZCB1c2UgdGhlbSBhcyBpbXBvcnRzLlxuXG5UbyBidWlsZCB0aGUgZW50cnkgZmlsZSB0byBXZWJBc3NlbWJseSB3aGVuIHlvdSBhcmUgcmVhZHksIHJ1bjpcblxuICAke2dldFBtQ29tbWFuZHMoKS5ydW59IGJ1aWxkXG5cblJ1bm5pbmcgdGhlIGNvbW1hbmQgYWJvdmUgY3JlYXRlcyB0aGUgZm9sbG93aW5nIGJpbmFyaWVzIGluY2wuIHRoZWlyIHJlc3BlY3RpdmVcbnRleHQgZm9ybWF0IHJlcHJlc2VudGF0aW9ucyBhbmQgc291cmNlIG1hcHM6XG5cbiAge2N5YW4gLi9idWlsZC91bnRvdWNoZWQud2FzbX1cbiAge2N5YW4gLi9idWlsZC91bnRvdWNoZWQud2FzbS5tYXB9XG4gIHtjeWFuIC4vYnVpbGQvdW50b3VjaGVkLndhdH1cblxuICBeIFRoZSB1bnRvdWNoZWQgV2ViQXNzZW1ibHkgbW9kdWxlIGFzIGdlbmVyYXRlZCBieSB0aGUgY29tcGlsZXIuXG4gICAgVGhpcyBvbmUgbWF0Y2hlcyB5b3VyIHNvdXJjZXMgZXhhY3RseSwgd2l0aG91dCBhbnkgb3B0aW1pemF0aW9ucy5cblxuICB7Y3lhbiAuL2J1aWxkL29wdGltaXplZC53YXNtfVxuICB7Y3lhbiAuL2J1aWxkL29wdGltaXplZC53YXNtLm1hcH1cbiAge2N5YW4gLi9idWlsZC9vcHRpbWl6ZWQud2F0fVxuXG4gIF4gVGhlIG9wdGltaXplZCBXZWJBc3NlbWJseSBtb2R1bGUgdXNpbmcgZGVmYXVsdCBvcHRpbWl6YXRpb24gc2V0dGluZ3MuXG4gICAgWW91IGNhbiBjaGFuZ2UgdGhlIG9wdGltaXphdGlvbiBzZXR0aW5ncyBpbiB7Y3lhbiAncGFja2FnZS5qc29uJ30uXG5cblRvIHJ1biB0aGUgdGVzdHMsIGRvOlxuXG4gICR7Z2V0UG1Db21tYW5kcygpLnRlc3R9XG5cblRoZSBBc3NlbWJseVNjcmlwdCBkb2N1bWVudGF0aW9uIGNvdmVycyBhbGwgdGhlIGRldGFpbHM6XG5cbiAgaHR0cHM6Ly9kb2NzLmFzc2VtYmx5c2NyaXB0Lm9yZ1xuXG5IYXZlIGEgbmljZSBkYXkhXG5gO1xuXG5mdW5jdGlvbiBpbml0TXNnKGJhc2VEaXI6IHN0cmluZyk6IHN0cmluZyB7XG4gIGxldCBtc2cgPSBbXG4gICAgY2hhbGtgVGhpcyBjb21tYW5kIHdpbGwgbWFrZSBzdXJlIHRoYXQgdGhlIGZvbGxvd2luZyBmaWxlcyBleGlzdCBpbiB0aGUgcHJvamVjdGAsXG4gICAgY2hhbGtgZGlyZWN0b3J5IHtib2xkIFwiJHtiYXNlRGlyfVwiOn1gLFxuICAgIGBgLFxuICBdO1xuICBmb3IgKGxldCBmaWxlIG9mIGluaXRGaWxlcykge1xuICAgIG1zZy5wdXNoKGNoYWxrYCAge2N5YW4gLi8ke2ZpbGUucGF0aH19YCk7XG4gICAgbXNnLnB1c2goY2hhbGtgICAke2ZpbGUuZGVzY3JpcHRpb259YCk7XG4gICAgbXNnLnB1c2goYGApO1xuICB9XG4gIG1zZy5wdXNoKFxuICAgIGBUaGUgY29tbWFuZCB3aWxsIHRyeSB0byB1cGRhdGUgZXhpc3RpbmcgZmlsZXMgdG8gbWF0Y2ggdGhlIGNvcnJlY3Qgc2V0dGluZ3NgXG4gICk7XG4gIG1zZy5wdXNoKGBgKTtcbiAgcmV0dXJuIG1zZy5qb2luKFwiXFxuXCIpO1xufVxuXG5leHBvcnQgY29uc3QgSW5pdENtZDogeWFyZ3MuQ29tbWFuZE1vZHVsZSA9IHtcbiAgY29tbWFuZDogXCJpbml0IFtiYXNlRGlyXVwiLFxuICBkZXNjcmliZTogXCJDcmVhdGUgYSBuZXcgQVMgcGFja2FnZSBpbiBhbiBnaXZlbiBkaXJlY3RvcnlcIixcbiAgYnVpbGRlcjogKHkpID0+XG4gICAgeS5wb3NpdGlvbmFsKFwiYmFzZURpclwiLCB7XG4gICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgZGVmYXVsdDogXCIuXCIsXG4gICAgICBkZXNjcmlwdGlvbjogXCJDcmVhdGUgYSBzYW1wbGUgQVMgcHJvamVjdCBpbiB0aGlzIGRpcmVjdG9yeVwiLFxuICAgIH0pLFxuICBoYW5kbGVyOiBhc3luYyAoYXJncykgPT4ge1xuICAgIGNvbnN0IGJhc2VEaXI6IHN0cmluZyA9IHBhdGgucmVzb2x2ZShhcmdzLmJhc2VEaXIgYXMgc3RyaW5nKTtcbiAgICBjb25zb2xlLmxvZyhpbml0TXNnKGJhc2VEaXIpKTtcbiAgICBpZiAoIShhd2FpdCBhc2tZZXNObyhjaGFsa2B7Ym9sZCBIZWxsbz99YCkpKSByZXR1cm47XG4gICAgdHJ5IHtcbiAgICAgIHdyaXRlRmlsZXMoYmFzZURpcik7XG4gICAgICBjb25zb2xlLmxvZyhkb25lTXNnKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS95YXJncy95YXJncy9pc3N1ZXMvMTA2OSNpc3N1ZWNvbW1lbnQtNDY4NDUxNDUwXG4gICAgICAvLyBJZiBlcnJvciBpcyB0aHJvd24gaW4gYXN5bmMgaGFuZGxlciwgcGFyc2VyIGlzIHJ1biB0d2ljZSB3aGljaFxuICAgICAgLy8gY2F1c2UgdGhlIGhlbHAgY29tbWFuZHMgdG8gcHJpbnQgYWxvbmcgd2l0aCBlcnJvciBzdGFja1xuICAgICAgLy8gU28gdG8gcHJldmVudCB0aGF0IHdlIGNhdGNoIHRoZSBlcnJvciBhbmQgc2ltcGx5IHByaW50IGl0LlxuICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgY2hhbGtge2JvbGQuYmdSZWRCcmlnaHQgRVJST1I6fSBVbmV4cGVjdGVkIEVycm9yIHdoaWxlIHRyeWluZyB0byB3cml0ZSBpbml0IGZpbGVzLmBcbiAgICAgICk7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfVxuICB9LFxufTtcblxuZnVuY3Rpb24gd3JpdGVGaWxlcyhiYXNlRGlyOiBzdHJpbmcpIHtcbiAgY29uc29sZS5sb2coKTtcbiAgZm9yIChsZXQgZmlsZSBvZiBpbml0RmlsZXMpIHtcbiAgICBjb25zb2xlLmxvZyhjaGFsa2AtIE1ha2luZyBzdXJlIHRoYXQgJyR7ZmlsZS5wYXRofScgaXMgc2V0IHVwLi4uYCk7XG4gICAgY29uc3QgcmVsYXRpdmVQYXRoID0gZmlsZS5nZXRSZWxhdGl2ZVBhdGgoYmFzZURpcik7XG4gICAgc3dpdGNoIChmaWxlLndyaXRlKGJhc2VEaXIpKSB7XG4gICAgICBjYXNlIEluaXRSZXN1bHQuQ1JFQVRFRDpcbiAgICAgICAgY29uc29sZS5sb2coY2hhbGtgICB7Z3JlZW4gQ3JlYXRlZDp9ICR7cmVsYXRpdmVQYXRofVxcbmApO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgSW5pdFJlc3VsdC5FWElTVFM6XG4gICAgICAgIGNvbnNvbGUubG9nKGNoYWxrYCAge3llbGxvdyBFeGlzdHM6fSAke3JlbGF0aXZlUGF0aH1cXG5gKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEluaXRSZXN1bHQuVVBEQVRFRDpcbiAgICAgICAgY29uc29sZS5sb2coY2hhbGtgICB7Z3JlZW5CcmlnaHQgVXBkYXRlZDp9ICR7cmVsYXRpdmVQYXRofVxcbmApO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBjb25zb2xlLmxvZyhjaGFsa2B7Ym9sZC5ncmVlbiBEb25lIX1gKTtcbn1cbiJdfQ==